# -*- coding: utf-8 -*-
"""
Created on Thu Jan 11 09:53:21 2018

@author: sunginous
"""

import requests
from requests.exceptions import RequestException
import re
from multiprocessing import Pool
import pyquery as pq
import random
import json

''' 停车场经纬度，该部分数据可以从百度地图爬取 '''
lng_lat = [[ 114.1308 , 22.592997 ],
[ 114.126357 , 22.535295 ],
[ 114.131179 , 22.557639 ],
[ 114.142075 , 22.553433 ],
[ 114.119451 , 22.550038 ],
[ 114.116652 , 22.545627 ],
[ 114.125114 , 22.540215 ],
[ 114.126575 , 22.547875 ],
[ 114.123499 , 22.550645 ],
[ 114.120748 , 22.548028 ],
[ 114.125784 , 22.547846 ],
[ 114.118168 , 22.543588 ],
[ 114.126857 , 22.592363 ],
[ 114.131609 , 22.593914 ],
[ 114.169428 , 22.611842 ],
[ 114.163508 , 22.610753 ],
[ 114.136761 , 22.592191 ],
[ 114.130639 , 22.593964 ],
[ 114.141869 , 22.590277 ],
[ 114.129456 , 22.592011 ],
[ 114.130011 , 22.58835 ],
[ 114.125261 , 22.590615 ],
[ 114.119617 , 22.593406 ],
[ 114.115844 , 22.590291 ],
[ 114.115023 , 22.592317 ],
[ 114.116069 , 22.593033 ],
[ 114.113589 , 22.588552 ],
[ 114.113586 , 22.591252 ],
[ 114.083371 , 22.589062 ],
[ 114.123942 , 22.593003 ],
[ 114.115628 , 22.589685 ],
[ 114.175339 , 22.564026 ],
[ 114.194258 , 22.560869 ],
[ 114.183424 , 22.569494 ],
[ 114.190103 , 22.561682 ],
[ 114.173845 , 22.567731 ],
[ 114.177575 , 22.567796 ],
[ 114.17648 , 22.56677 ],
[ 114.178914 , 22.566619 ],
[ 114.178345 , 22.569621 ],
[ 114.17683 , 22.574213 ],
[ 114.178676 , 22.570521 ],
[ 114.176688 , 22.564783 ],
[ 114.171057 , 22.57115 ],
[ 114.185148 , 22.570522 ],
[ 114.185779 , 22.585566 ],
[ 114.194667 , 22.560977 ],
[ 114.197941 , 22.563055 ],
[ 114.185104 , 22.585241 ],
[ 114.174996 , 22.569581 ],
[ 114.180279 , 22.564975 ],
[ 114.136838 , 22.552432 ],
[ 114.14627 , 22.551313 ],
[ 114.13651 , 22.566691 ],
[ 114.133062 , 22.571753 ],
[ 114.127551 , 22.582813 ],
[ 114.127683 , 22.582762 ],
[ 114.129869 , 22.551263 ],
[ 114.13333 , 22.56947 ],
[ 114.138293 , 22.552955 ],
[ 114.139434 , 22.556271 ],
[ 114.139955 , 22.555177 ],
[ 114.135705 , 22.584446 ],
[ 114.135073 , 22.584038 ],
[ 114.14397 , 22.575844 ],
[ 114.144772 , 22.564553 ],
[ 114.128601 , 22.568213 ],
[ 114.146602 , 22.547175 ],
[ 114.13435 , 22.54977 ],
[ 114.148527 , 22.587291 ],
[ 114.130541 , 22.577331 ],
[ 114.148821 , 22.581761 ],
[ 114.140467 , 22.553012 ],
[ 114.136019 , 22.551605 ],
[ 114.137 , 22.547367 ],
[ 114.143417 , 22.547864 ],
[ 114.128998 , 22.583602 ],
[ 114.130307 , 22.547268 ],
[ 114.133741 , 22.545704 ],
[ 114.166408 , 22.56091 ],
[ 114.12713 , 22.567252 ],
[ 114.150386 , 22.584072 ],
[ 114.132025 , 22.577315 ],
[ 114.142447 , 22.58196 ],
[ 114.144774 , 22.569037 ],
[ 114.145292 , 22.575911 ],
[ 114.142417 , 22.57546 ],
[ 114.136299 , 22.556914 ],
[ 114.12905 , 22.554036 ],
[ 114.131988 , 22.54418 ],
[ 114.140852 , 22.559014 ],
[ 114.15828 , 22.559843 ],
[ 114.136847 , 22.554426 ],
[ 114.154824 , 22.556018 ],
[ 114.144188 , 22.565042 ],
[ 114.144429 , 22.55209 ],
[ 114.136297 , 22.551634 ],
[ 114.152288 , 22.56197 ],
[ 114.139613 , 22.574414 ],
[ 114.132523 , 22.545755 ],
[ 114.142433 , 22.575509 ],
[ 114.139281 , 22.562997 ],
[ 114.139047 , 22.58004 ],
[ 114.128842 , 22.565316 ],
[ 114.135533 , 22.579019 ],
[ 114.140876 , 22.54882 ],
[ 114.136255 , 22.546507 ],
[ 114.135715 , 22.552899 ],
[ 114.13539 , 22.545012 ],
[ 114.150385 , 22.584247 ],
[ 114.134894 , 22.565466 ],
[ 114.13699 , 22.550571 ],
[ 114.129545 , 22.572851 ],
[ 114.135384 , 22.54885 ],
[ 114.14839 , 22.559766 ],
[ 114.137144 , 22.573588 ],
[ 114.136404 , 22.571008 ],
[ 114.141492 , 22.575914 ],
[ 114.143153 , 22.586915 ],
[ 114.139342 , 22.559053 ],
[ 114.149935 , 22.553911 ],
[ 114.126705 , 22.565558 ],
[ 114.138392 , 22.550512 ],
[ 114.152361 , 22.558282 ],
[ 114.149742 , 22.553772 ],
[ 114.151307 , 22.582735 ],
[ 114.14102 , 22.554664 ],
[ 114.130849 , 22.572839 ],
[ 114.13108 , 22.572623 ],
[ 114.149502 , 22.565996 ],
[ 114.130005 , 22.57801 ],
[ 114.140674 , 22.554326 ],
[ 114.131329 , 22.582754 ],
[ 114.145731 , 22.584756 ],
[ 114.128752 , 22.553514 ],
[ 114.144176 , 22.577297 ],
[ 114.146032 , 22.564368 ],
[ 114.13053 , 22.544219 ],
[ 114.132098 , 22.577379 ],
[ 114.133053 , 22.549048 ],
[ 114.146076 , 22.582927 ],
[ 114.127945 , 22.556354 ],
[ 114.135629 , 22.571243 ],
[ 114.140861 , 22.557772 ],
[ 114.129371 , 22.553636 ],
[ 114.135134 , 22.562235 ],
[ 114.132162 , 22.544775 ],
[ 114.131575 , 22.544353 ],
[ 114.127602 , 22.556631 ],
[ 114.14265 , 22.56191 ],
[ 114.127329 , 22.586125 ],
[ 114.139353 , 22.579424 ],
[ 114.12974 , 22.574359 ],
[ 114.158084 , 22.554212 ],
[ 114.168539 , 22.564549 ],
[ 114.126435 , 22.567236 ],
[ 114.148031 , 22.572708 ],
[ 114.13047 , 22.551029 ],
[ 114.141913 , 22.551413 ],
[ 114.128337 , 22.587479 ],
[ 114.14239 , 22.582002 ],
[ 114.142047 , 22.546511 ],
[ 114.147642 , 22.567695 ],
[ 114.131906 , 22.546793 ],
[ 114.138653 , 22.547691 ],
[ 114.146229 , 22.569045 ],
[ 114.128429 , 22.560435 ],
[ 114.128475 , 22.571174 ],
[ 114.136423 , 22.566266 ],
[ 114.127728 , 22.586106 ],
[ 114.138349 , 22.555455 ],
[ 114.13487 , 22.547358 ],
[ 114.153199 , 22.551213 ],
[ 114.147124 , 22.583553 ],
[ 114.13474 , 22.581976 ],
[ 114.136684 , 22.577121 ],
[ 114.133968 , 22.556143 ],
[ 114.150555 , 22.560752 ],
[ 114.140508 , 22.554 ],
[ 114.129974 , 22.547993 ],
[ 114.130544 , 22.564291 ],
[ 114.135529 , 22.565736 ],
[ 114.133058 , 22.546191 ],
[ 114.147852 , 22.567129 ],
[ 114.128219 , 22.583962 ],
[ 114.148777 , 22.580036 ],
[ 114.129114 , 22.54439 ],
[ 114.134224 , 22.561044 ],
[ 114.144772 , 22.567526 ],
[ 114.126769 , 22.548661 ],
[ 114.130372 , 22.547525 ],
[ 114.161032 , 22.56218 ],
[ 114.156475 , 22.56169 ],
[ 114.133489 , 22.561413 ],
[ 114.149395 , 22.579558 ],
[ 114.126885 , 22.555253 ],
[ 114.126596 , 22.559801 ],
[ 114.147546 , 22.553658 ],
[ 114.140032 , 22.563595 ],
[ 114.14643 , 22.566956 ],
[ 114.136946 , 22.550404 ],
[ 114.139129 , 22.552523 ],
[ 114.125978 , 22.550559 ],
[ 114.149324 , 22.551113 ],
[ 114.140406 , 22.559205 ],
[ 114.149991 , 22.57123 ],
[ 114.139683 , 22.582917 ],
[ 114.126575 , 22.582582 ],
[ 114.134711 , 22.554161 ],
[ 114.141551 , 22.549012 ],
[ 114.131035 , 22.545307 ],
[ 114.129593 , 22.575829 ],
[ 114.134583 , 22.544897 ],
[ 114.151586 , 22.579907 ],
[ 114.136901 , 22.554274 ],
[ 114.167636 , 22.564137 ],
[ 114.146783 , 22.560416 ],
[ 114.145487 , 22.550538 ],
[ 114.136334 , 22.576737 ],
[ 114.149402 , 22.58464 ],
[ 114.135252 , 22.562306 ],
[ 114.133785 , 22.559617 ],
[ 114.134072 , 22.573744 ],
[ 114.137963 , 22.556354 ],
[ 114.131215 , 22.544239 ],
[ 114.130574 , 22.547022 ],
[ 114.158113 , 22.56027 ],
[ 114.145629 , 22.552259 ],
[ 114.169224 , 22.565902 ],
[ 114.136703 , 22.550195 ],
[ 114.156798 , 22.556756 ],
[ 114.150155 , 22.573373 ],
[ 114.136883 , 22.546265 ],
[ 114.149118 , 22.586365 ],
[ 114.133649 , 22.582619 ],
[ 114.12657 , 22.58544 ],
[ 114.151535 , 22.568432 ],
[ 114.143047 , 22.556698 ],
[ 114.128044 , 22.557247 ],
[ 114.128055 , 22.544177 ],
[ 114.129867 , 22.563539 ],
[ 114.201538 , 22.59502 ],
[ 114.202086 , 22.594776 ],
[ 114.185299 , 22.58924 ],
[ 114.202362 , 22.595291 ],
[ 114.126705 , 22.590052 ],
[ 114.1276 , 22.588375 ],
[ 114.139819 , 22.592046 ],
[ 114.139879 , 22.592025 ],
[ 114.1438 , 22.590396 ],
[ 114.128331 , 22.592806 ],
[ 114.144637 , 22.590547 ],
[ 114.139962 , 22.589205 ],
[ 114.127753 , 22.594138 ],
[ 114.140078 , 22.593232 ],
[ 114.144641 , 22.58886 ],
[ 114.144159 , 22.589544 ],
[ 114.143844 , 22.590503 ],
[ 114.163409 , 22.610073 ],
[ 114.126085 , 22.594623 ],
[ 114.140755 , 22.593572 ],
[ 114.147213 , 22.589285 ],
[ 114.113734 , 22.58995 ],
[ 114.121865 , 22.596532 ],
[ 114.11288 , 22.588785 ],
[ 114.125903 , 22.589695 ],
[ 114.088545 , 22.588739 ],
[ 114.113158 , 22.589444 ],
[ 114.113412 , 22.591192 ],
[ 114.124781 , 22.589545 ],
[ 114.114494 , 22.591132 ],
[ 114.125339 , 22.5881 ],
[ 114.119538 , 22.589352 ],
[ 114.183451 , 22.569973 ],
[ 114.181646 , 22.570882 ],
[ 114.180945 , 22.569513 ],
[ 114.185232 , 22.569079 ],
[ 114.195289 , 22.562001 ],
[ 114.177738 , 22.574228 ],
[ 114.18186 , 22.569397 ],
[ 114.17674 , 22.571958 ],
[ 114.175008 , 22.568211 ],
[ 114.179005 , 22.567772 ],
[ 114.194878 , 22.561195 ],
[ 114.175517 , 22.571298 ],
[ 114.194195 , 22.561312 ],
[ 114.186202 , 22.56384 ],
[ 114.174078 , 22.569991 ],
[ 114.18343 , 22.564072 ],
[ 114.181439 , 22.573602 ],
[ 114.183399 , 22.569974 ],
[ 114.181089 , 22.566527 ],
[ 114.181277 , 22.575361 ],
[ 114.188908 , 22.56573 ],
[ 114.187219 , 22.565638 ],
[ 114.191228 , 22.566631 ],
[ 114.17224 , 22.572704 ],
[ 114.190988 , 22.566907 ],
[ 114.17684 , 22.571458 ],
[ 114.188047 , 22.583921 ],
[ 114.175159 , 22.575115 ],
[ 114.143925 , 22.584379 ],
[ 114.136326 , 22.579757 ],
[ 114.154115 , 22.55858 ],
[ 114.118609 , 22.557832 ],
[ 114.115675 , 22.547287 ],
[ 114.11311 , 22.549356 ],
[ 114.135183 , 22.562703 ],
[ 114.112493 , 22.548074 ],
[ 114.139754 , 22.579267 ],
[ 114.140149 , 22.57582 ],
[ 114.112046 , 22.561438 ],
[ 114.13473 , 22.56748 ],
[ 114.169348 , 22.571528 ],
[ 114.17021 , 22.56811 ],
[ 114.195875 , 22.56232 ],
[ 114.117569 , 22.593994 ],
[ 114.10487 , 22.57604 ],
[ 114.129459 , 22.561827 ],
[ 114.113339 , 22.561797 ],
[ 114.133458 , 22.568758 ],
[ 114.11695 , 22.553417 ],
[ 114.131819 , 22.557171 ],
[ 114.136905 , 22.569322 ],
[ 114.10372 , 22.575367 ],
[ 114.119005 , 22.59153 ],
[ 114.119224 , 22.551483 ],
[ 114.128152 , 22.588855 ],
[ 114.128349 , 22.55618 ],
[ 114.116194 , 22.560786 ],
[ 114.123596 , 22.552334 ],
[ 114.130094 , 22.572702 ],
[ 114.115152 , 22.560996 ],
[ 114.128255 , 22.555801 ],
[ 114.122586 , 22.553094 ],
[ 114.135498 , 22.568072 ],
[ 114.114116 , 22.556744 ],
[ 114.091453 , 22.57647 ],
[ 114.136886 , 22.557781 ],
[ 114.112728 , 22.547948 ],
[ 114.135751 , 22.562661 ],
[ 114.133489 , 22.56141 ],
[ 114.14259 , 22.578024 ],
[ 114.13441 , 22.566531 ],
[ 114.123911 , 22.54983 ],
[ 114.115844 , 22.542512 ],
[ 114.116493 , 22.547345 ],
[ 114.113114 , 22.545977 ],
[ 114.13338 , 22.555972 ],
[ 114.113848 , 22.5458 ],
[ 114.111499 , 22.551282 ],
[ 114.136901 , 22.55427 ],
[ 114.127522 , 22.560643 ],
[ 114.111713 , 22.552004 ],
[ 114.123378 , 22.550572 ],
[ 114.137105 , 22.554138 ],
[ 114.117187 , 22.55566 ],
[ 114.130766 , 22.557891 ],
[ 114.135247 , 22.557188 ],
[ 114.119239 , 22.553402 ],
[ 114.11528 , 22.561487 ],
[ 114.127752 , 22.551419 ],
[ 114.130128 , 22.571281 ],
[ 114.131926 , 22.5517 ],
[ 114.117016 , 22.550429 ],
[ 114.13564 , 22.565724 ],
[ 114.133254 , 22.557172 ],
[ 114.136198 , 22.574428 ],
[ 114.137171 , 22.554328 ],
[ 114.136905 , 22.555541 ],
[ 114.136144 , 22.556247 ],
[ 114.127621 , 22.561704 ],
[ 114.114606 , 22.561329 ],
[ 114.11769 , 22.551051 ],
[ 114.115114 , 22.557724 ],
[ 114.135813 , 22.58266 ],
[ 114.125653 , 22.554879 ],
[ 114.11776 , 22.556607 ],
[ 114.131229 , 22.562051 ],
[ 114.131096 , 22.558109 ],
[ 114.134991 , 22.573682 ],
[ 114.131853 , 22.564538 ],
[ 114.12678 , 22.553795 ],
[ 114.12729 , 22.550748 ],
[ 114.13433 , 22.584036 ],
[ 114.120013 , 22.551416 ],
[ 114.129421 , 22.557403 ],
[ 114.115274 , 22.546433 ],
[ 114.132535 , 22.555328 ],
[ 114.130713 , 22.567266 ],
[ 114.130616 , 22.552875 ],
[ 114.120308 , 22.56021 ],
[ 114.119662 , 22.557805 ],
[ 114.117685 , 22.554795 ],
[ 114.132333 , 22.571607 ],
[ 114.140298 , 22.580693 ],
[ 114.116589 , 22.561618 ],
[ 114.190197 , 22.561637 ],
[ 114.111576 , 22.56084 ],
[ 114.095399 , 22.577472 ],
[ 114.174326 , 22.567487 ],
[ 114.140777 , 22.563975 ]
]

''' 其他POI经纬度 '''
lng_lat_new = [
[114.034469, 22.678382],
[114.03432858666, 22.678277996336],
[113.929643, 22.652811],
[114.06480319774, 22.636337203806],
[113.836326, 22.728234],
[114.057069, 22.659458],
[113.918271, 22.523655],
[113.875078, 22.576236],
[114.062667, 22.676062],
[113.8644813233, 22.811753576535],
[113.900063,22.675904],
[113.89931267568, 22.674658686602],
[114.039896, 22.632685],
[114.04118013257, 22.632159931134],
[113.904594, 22.554087],
[113.90355788246, 22.555001631547],
[114.05246127324, 22.620705918921],
[114.05065, 22.630097],
[113.893296, 22.607663],
[113.89297690805, 22.606702252181],
[113.898792, 22.562474],
[113.898490639, 22.561632959988],
[113.897268, 22.594133],
[113.89802277274, 22.594188851905],
[113.911415, 22.57197],
[14.13525, 22.55465],
[114.047548, 22.615401],
[113.89267808852, 22.565527405263],
[114.042555, 22.527726],
[113.897157, 22.580788],
[113.89556176419, 22.581391308208],
[113.942631, 22.522699],
[113.981742, 22.543633],
[114.060586, 22.541451],
[114.250122, 22.720651],
[113.912381, 22.566246],
[114.14798292468, 22.573173731799],
[114.05602754701, 22.700313387885],
[114.12619379781, 22.536837463742],
[114.130979, 22.615549001128],
[114.066356, 22.541452],
[113.987249, 22.547732],
[114.299739, 22.623307],
[114.31364787252, 22.609575206799],
[113.78055, 22.733244],
[114.066161, 22.536361],
[114.000489, 22.542889],
[114.521316, 22.599508],
[114.00710349246, 22.531398009444]
]

def get_one_page(url):
    try:
        response = requests.get(url)
        if response.status_code == 200:
            return response.text
        return None
    except RequestException:
        return None

def parse_one_page(html):
    pattern = re.compile(r'.*?"path":"(.*?)",.*?', re.S)
    road = re.findall(pattern, html)
    data = []
    for i in road:
        data.append(i.split(';'))
    allline = []
    for i in range(len(data)):
        for j in range(len(data[i])):
            allline.append(data[i][j].split(','))
    enddata = []
    for i in allline:
        enddata.append([float(i[0]), float(i[1])])
    return enddata
# =============================================================================
#     lng = re.findall(r'.*?"lng":(.*?),.*?', html)
#     lat = re.findall(r'.*?"lat":(.*?)}.*?', html)
#     road = []
#     for i in range(len(lng)):
#         road.append([float(lng[i]), float(lat[i])])
#     return road
# =============================================================================
    
def main():
# =============================================================================
#     location = [
#             [[114.125784, 22.547846], [114.083371, 22.589062]],
#             [[114.173845, 22.567731], [114.13435, 22.54977]],
#             [[114.135705, 22.584446], [114.150385, 22.584247]],
#             [[114.13108, 22.572623], [114.128337, 22.587479]],
#             [[114.156475, 22.56169], [114.122586, 22.553094]],
#             [[114.130766, 22.557891], [114.139754, 22.579267]],
#             [[114.128255, 22.555801], [114.13441, 22.566531]],
#             [[114.119239, 22.553402], [114.12678, 22.553795]],
#             [[114.132333, 22.571607], [114.131926, 22.5517]],
#             [[114.113114, 22.545977], [114.118609, 22.557832]],
#             [[114.147213, 22.589285], [114.128044, 22.557247]],
#             [[114.181646, 22.570882], [114.191228, 22.566631]],
#             [[114.140149, 22.57582], [114.113339, 22.561797]],
#             [[114.123596, 22.552334], [114.13564, 22.565724]],
#             [[114.116493, 22.547345], [114.117187, 22.55566]],
#             [[114.133254, 22.557172], [114.147852, 22.567129]],
#             [[114.141913, 22.551413], [114.127945, 22.556354]],
#             [[114.131906, 22.546793], [114.127728, 22.586106]],
#             [[114.139047, 22.58004], [114.130307, 22.547268]],
#             [[114.135715, 22.552899], [114.17683, 22.574213]]
#             ]
# =============================================================================
    location = [[lng_lat[random.randrange(0,401,1)], lng_lat[random.randrange(0,401,1)]] for i in range(500)]#一次性随机生成500对起始、终止点
    result = []
    for spot in location:
        origin_weidu = spot[0][1]
        origin_jingdu = spot[0][0]
        desrination_weidu = spot[1][1]
        desrination_jingdu = spot[1][0]
        url = r'http://api.map.baidu.com/direction/v2/driving?origin='+str(origin_weidu)+','+str(origin_jingdu)+'&destination='+str(desrination_weidu)+','+str(desrination_jingdu)+'&ak=53oVIOgmSIejwV7EfphPgTynOZbIiVYu'
        html = get_one_page(url)
        line = parse_one_page(html)
        result.append(line)
        #print(line,',')

    with open("line.json","w") as f:
        f.write(json.dumps(result))


if __name__=='__main__':
    main()
    